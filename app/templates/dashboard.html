{% extends "base.html" %}
{% block content %}
<div class="grid md:grid-cols-6 gap-4">
  <div class="bg-white rounded border border-slate-200 p-4">
    <div class="text-sm text-slate-500">Units (MTD)</div>
    <div class="text-3xl font-bold">{{ units_mtd }}</div>
    <div class="text-xs text-slate-500 mt-1">
      New: {{ new_mtd }} Â· Used: {{ used_mtd }}
    </div>
  </div>

  <div class="bg-white rounded border border-slate-200 p-4">
    <div class="text-sm text-slate-500">Commission (MTD)</div>
    <div class="text-3xl font-bold">
      ${{ "{:,.0f}".format(comm_mtd or 0) }}
    </div>
  </div>
  <div class="bg-white rounded border border-slate-200 p-4">
    <div class="text-sm text-slate-500">Units (YTD)</div>
    <div class="text-3xl font-bold">{{ units_ytd }}</div>
  </div>

  <div class="bg-white rounded border border-slate-200 p-4">
    <div class="text-sm text-slate-500">Commission (YTD)</div>
    <div class="text-3xl font-bold">
      ${{ "{:,.0f}".format(comm_ytd or 0) }}
    </div>
  </div>
  <div class="bg-white rounded border border-slate-200 p-4">
    <div class="text-sm text-slate-500">Pending</div>
    <div class="text-3xl font-bold">{{ pending }}</div>
  </div>

  <div class="bg-white rounded border border-slate-200 p-4">
    <div class="text-sm text-slate-500">Year</div>
    <div class="text-3xl font-bold">{{ year }}</div>
  </div>
</div>
<div class="mt-6 bg-white rounded border border-slate-200 p-4">
  <div class="text-sm text-slate-500 mb-2">{{ year }} Unit Trend</div>
  <div class="grid grid-cols-12 gap-2 text-center text-sm">
    {% for i in range(12) %}
      <div>
        <div class="text-xs text-slate-500">
          {{ month_labels[i] }}
        </div>
        <div class="font-bold text-lg">
          {{ units_by_month[i] }}
        </div>
      </div>
    {% endfor %}
  </div>
</div>

<div class="mt-6 flex items-center justify-between">
  <h2 class="text-lg font-bold">Pending Deals</h2>
  <a class="text-sm underline" href="/pending">View all</a>
</div>

<div class="mt-2 overflow-x-auto bg-white rounded border border-slate-200">
<table class="min-w-full text-sm">
  <thead class="bg-slate-900 text-white">
    <tr>
      <th class="text-left p-2">Sold</th>
      <th class="text-left p-2">Customer</th>
      <th class="text-left p-2">Model</th>
      <th class="text-right p-2">Est. Comm</th>
      <th class="p-2"></th>
    </tr>
  </thead>
  <tbody>
    {% for d in pending_deals %}
      <tr class="border-t">
        <td class="p-2">{{ d.sold_date or "" }}</td>
        <td class="p-2">{{ d.customer }}</td>
        <td class="p-2">{{ d.model }}</td>
        <td class="p-2 text-right">${{ "{:,.0f}".format(d.total_deal_comm or 0) }}</td>
        <td class="p-2 text-right">
          <a class="underline text-sm" href="/deals/{{ d.id }}/edit">Edit</a>
        </td>
      </tr>
    {% endfor %}

    {% if not pending_deals %}
      <tr class="border-t">
        <td class="p-4 text-slate-500" colspan="5">No pending deals ðŸŽ‰</td>
      </tr>
    {% endif %}
  </tbody>
</table>
</div>

<div class="mt-2 overflow-x-auto bg-white rounded border border-slate-200">
<table class="min-w-full text-sm">
  <thead class="bg-slate-900 text-white">
    <tr>
      <th class="text-left p-2">Delivered</th>
      <th class="text-left p-2">Customer</th>
      <th class="text-left p-2">Model</th>
      <th class="text-left p-2">Status</th>
      <th class="text-right p-2">Total Comm</th>
      <th class="p-2"></th>
    </tr>
  </thead>
  <tbody>
    {% for d in recent %}
      <tr class="border-t">
        <td class="p-2">{{ d.delivered_date or "" }}</td>
        <td class="p-2">{{ d.customer }}</td>
        <td class="p-2">{{ d.model }}</td>
        <td class="p-2">
          {% if d.status == "Delivered" %}
            <span class="px-2 py-0.5 rounded bg-emerald-100 text-emerald-900">{{ d.status }}</span>
          {% elif d.status == "Pending" %}
            <span class="px-2 py-0.5 rounded bg-amber-100 text-amber-900">{{ d.status }}</span>
          {% elif d.status == "Dead" %}
            <span class="px-2 py-0.5 rounded bg-rose-100 text-rose-900">{{ d.status }}</span>
          {% else %}
            <span class="px-2 py-0.5 rounded bg-slate-100">{{ d.status }}</span>
          {% endif %}
        </td>
        <td class="p-2 text-right">${{ "{:,.0f}".format(d.total_deal_comm or 0) }}</td>
        <td class="p-2 text-right"><a class="underline text-sm" href="/deals/{{ d.id }}/edit">Edit</a></td>
      </tr>
    {% endfor %}
  </tbody>
</table>
</div>
{% endblock %}
